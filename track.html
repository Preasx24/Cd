<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ad Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; text-align: center; padding: 2rem; }
    .box { background: #222; padding: 2rem; border-radius: 10px; display: inline-block; }
  </style>
</head>
<body>
  <div class="box">
    <h2>ðŸ“¡ Tracking Recorded</h2>
    <p id="msg">Processing...</p>
  </div>
  <script>
    const tokenGistUrl = "https://gist.githubusercontent.com/Preasx24/c54812fe3d3e5f8d586f1dd010701919/raw/e6ebaaa6f2bb72ad1d2444b10ffb059f9c990fbe/gistfile1.txt";
    const mappingGistId = "4517ac43eff88b7e226fbbdc627a3c08";

    async function getGitHubToken() {
      const res = await fetch(tokenGistUrl);
      return (await res.text()).trim();
    }

    async function fetchMapping(token) {
      const res = await fetch(`https://api.github.com/gists/${mappingGistId}`, {
        headers: { "Authorization": `token ${token}` }
      });
      const data = await res.json();
      return JSON.parse(data.files["gistfile1.txt"].content || "{}");
    }

    async function track() {
      const code = location.hash.slice(1);
      if (!code) { document.getElementById("msg").textContent = "No access code"; return; }
      const token = await getGitHubToken();
      const mapping = await fetchMapping(token);
      const gistId = mapping[code];
      if (!gistId) { document.getElementById("msg").textContent = "Invalid access code"; return; }

      const gistRes = await fetch(`https://api.github.com/gists/${gistId}`, {
        headers: { "Authorization": `token ${token}` }
      });
      const gistData = await gistRes.json();
      let stats = JSON.parse(gistData.files["stats.json"].content);

      stats.totalClicks++;
      stats.todayClicks++;
      stats.totalRevenue += 0.01;
      stats.todayRevenue += 0.01;
      stats.lastUpdated = new Date().toISOString();

      await fetch(`https://api.github.com/gists/${gistId}`, {
        method: "PATCH",
        headers: { "Authorization": `token ${token}` },
        body: JSON.stringify({ files: { "stats.json": { content: JSON.stringify(stats, null, 2) } } })
      });

      document.getElementById("msg").textContent = `Tracked click for ${code}!`;
    }

    track();
  </script>
</body>
</html>