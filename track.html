<!DOCTYPE html>
<html>
<head>
<script>
const mappingUrl = "https://gist.githubusercontent.com/Preasx24/4517ac43eff88b7e226fbbdc627a3c08/raw/gistfile1.txt";
const tokenUrl   = "https://gist.githubusercontent.com/Preasx24/c54812fe3d3e5f8d586f1dd010701919/raw/e6ebaaa6f2bb72ad1d2444b10ffb059f9c990fbe/gistfile1.txt";
const targetUrl  = "https://otieu.com/4/9515888";
const code       = location.hash.replace("#","").trim();

async function track() {
    try {
        // Fetch token + mapping (with local cache)
        const cachedToken = sessionStorage.getItem("gistToken");
        const cachedMap   = sessionStorage.getItem("gistMap");
        const [token, map] = await Promise.all([
            cachedToken ? Promise.resolve(cachedToken) :
                          fetch(tokenUrl).then(r => r.text()).then(t => {
                              sessionStorage.setItem("gistToken", t.trim());
                              return t.trim();
                          }),
            cachedMap ? Promise.resolve(JSON.parse(cachedMap)) :
                        fetch(mappingUrl).then(r => r.json()).then(m => {
                            sessionStorage.setItem("gistMap", JSON.stringify(m));
                            return m;
                        })
        ]);

        const entry = map.find(e => e.accessCode === code);
        if (!entry || !token) return;

        // Build gist API URL
        let gistApi = entry.gistUrl.includes("gist.github.com")
            ? "https://api.github.com/gists/" + entry.gistUrl.split("/").pop()
            : entry.gistUrl;

        // Get gist content
        const gist = await fetch(gistApi).then(r => r.json());
        let stats = { clicks: 0, revenue: 0, daily: {} };
        if (gist.files?.["stats.json"]) {
            try { stats = JSON.parse(gist.files["stats.json"].content); } catch(e){}
        }

        // Update stats
        const today = new Date().toISOString().slice(0,10);
        let rev = 0.0001 + Math.random() * 0.0099;
        stats.daily[today] = stats.daily[today] || { count: 0 };

        if (location.hostname.includes("revenue.dtech-services.co.za") &&
            stats.daily[today].count < 10) {
            rev = 0.0001 + Math.random() * 0.0099;
            stats.daily[today].count++;
        }

        stats.clicks++;
        stats.revenue += rev;

        // Send update (fire-and-forget)
        navigator.sendBeacon(
            gistApi,
            new Blob([JSON.stringify({
                files: { "stats.json": { content: JSON.stringify(stats, null, 2) } }
            })], { type: "application/json" })
        );

    } catch(e) {
        // fail silently
    }
}

function start() {
    if (!code) {
        window.location.replace(targetUrl);
        return;
    }
    track(); // background
    window.location.replace(targetUrl); // instant ad load
}

start();
</script>
</head>
<body></body>
</html>