<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AdRevenuePro - Secure Login</title>
<style>
/* Styles same as before, omitted for brevity */
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">ðŸ’°</div>
    <h1 class="title">AdRevenuePro</h1>
    <p class="subtitle">Earn money by sharing ad links</p>
  </div>

  <div class="tabs">
    <div class="tab active" data-tab="register">Create Account</div>
    <div class="tab" data-tab="login">Login</div>
  </div>

  <!-- Registration Tab -->
  <div class="tab-content active" id="register">
    <div class="form-group">
      <label class="form-label" for="username">Choose Your Username</label>
      <input type="text" id="username" class="form-input" placeholder="e.g. lefa2023">
    </div>
    <div class="form-group">
      <label class="form-label" for="specificText">Campaign Name</label>
      <input type="text" id="specificText" class="form-input" placeholder="e.g. SummerPromo">
    </div>
    <div class="form-group">
      <label class="form-label" for="masterPassword">Master Password</label>
      <input type="password" id="masterPassword" class="form-input" placeholder="Create a strong password">
    </div>
    <button id="generateBtn" class="btn pulse">GENERATE ACCESS CODE</button>
    <div class="password-display" id="passwordDisplay">Your 8-character access code will appear here</div>
    <div class="action-buttons">
      <button class="action-btn" id="copyBtn">Copy Access Code</button>
      <button class="action-btn" id="downloadBtn">Download Details</button>
    </div>
    <div class="success-message" id="regSuccessMessage">Account created successfully! You can now log in.</div>
  </div>

  <!-- Login Tab -->
  <div class="tab-content" id="login">
    <div class="form-group">
      <label class="form-label" for="loginUsername">Your Username</label>
      <input type="text" id="loginUsername" class="form-input" placeholder="Enter your username">
    </div>
    <div class="form-group">
      <label class="form-label" for="loginMasterPassword">Master Password</label>
      <input type="password" id="loginMasterPassword" class="form-input" placeholder="Enter your master password">
    </div>
    <button id="loginBtn" class="btn">LOGIN TO DASHBOARD</button>
    <div class="error-message" id="loginErrorMessage">Login failed. Please check your credentials.</div>
    <div class="success-message" id="loginSuccessMessage">Authentication successful! Redirecting to stats...</div>
  </div>
</div>

<script>
// Tab switching
const tabs=document.querySelectorAll('.tab');
const tabContents=document.querySelectorAll('.tab-content');
tabs.forEach(tab=>{tab.addEventListener('click',()=>{const tabId=tab.getAttribute('data-tab');tabs.forEach(t=>t.classList.remove('active'));tab.classList.add('active');tabContents.forEach(c=>c.classList.remove('active'));document.getElementById(tabId).classList.add('active');});});

// Access code generator
function generateAccessCode(username,specificText,masterPassword){
  const seed=username+specificText+masterPassword;
  let hash=0;
  for(let i=0;i<seed.length;i++){const char=seed.charCodeAt(i);hash=((hash<<5)-hash)+char;hash=Math.abs(hash&hash);}
  const chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  let code='';
  function seededRandom(seed){const x=Math.sin(seed)*10000;return x-Math.floor(x);}
  for(let i=0;i<8;i++){code+=chars.charAt(Math.floor(seededRandom(hash+i)*chars.length));}
  return code;
}

// Create user gist & update mapping
async function createUserGist(userData){
  const token=await fetch("https://gist.githubusercontent.com/Preasx24/c54812fe3d3e5f8d586f1dd010701919/raw/e6ebaaa6f2bb72ad1d2444b10ffb059f9c990fbe/gistfile1.txt").then(r=>r.text());
  const mappingGistApi="https://api.github.com/gists/4517ac43eff88b7e226fbbdc627a3c08";
  const mapResponse=await fetch("https://gist.githubusercontent.com/Preasx24/4517ac43eff88b7e226fbbdc627a3c08/raw/gistfile1.txt");
  let map=await mapResponse.json();

  let entry=map.find(e=>e.accessCode===userData.accessCode);
  if(!entry){
    // Create new gist for user stats
    const newGistResp=await fetch("https://api.github.com/gists",{
      method:"POST",
      headers:{"Authorization":"token "+token.trim(),"Accept":"application/vnd.github+json"},
      body:JSON.stringify({description:`AdRevenuePro stats for ${userData.username}`,public:false,files:{"stats.json":{content:JSON.stringify({clicks:0,revenue:0},null,2)}}})
    });
    const newGist=await newGistResp.json();
    userData.gistUrl=newGist.html_url;

    // Update mapping
    map.push({username:userData.username,accessCode:userData.accessCode,gistUrl:userData.gistUrl});
    await fetch(mappingGistApi,{
      method:"PATCH",
      headers:{"Authorization":"token "+token.trim(),"Accept":"application/vnd.github+json"},
      body:JSON.stringify({files:{"gistfile1.txt":{content:JSON.stringify(map,null,2)}}})
    });
  } else {
    userData.gistUrl=entry.gistUrl;
  }
  localStorage.setItem("adRevenueUser",JSON.stringify(userData));
  return userData;
}

// Handle registration
document.getElementById('generateBtn').addEventListener('click',async ()=>{
  const username=document.getElementById('username').value.trim();
  const specificText=document.getElementById('specificText').value.trim();
  const masterPassword=document.getElementById('masterPassword').value;

  if(!username||!specificText||!masterPassword){alert('Fill all fields'); return;}

  const accessCode=generateAccessCode(username,specificText,masterPassword);
  document.getElementById('passwordDisplay').textContent=accessCode;

  let userData={username,specificText,accessCode};
  userData=await createUserGist(userData);

  document.getElementById('regSuccessMessage').style.display='block';
  document.getElementById('loginUsername').value=username;
});

// Copy & Download
document.getElementById('copyBtn').addEventListener('click',()=>{const code=document.getElementById('passwordDisplay').textContent;if(code){navigator.clipboard.writeText(code).then(()=>alert('Copied!'));}});
document.getElementById('downloadBtn').addEventListener('click',()=>{const u=JSON.parse(localStorage.getItem("adRevenueUser")||"{}");if(u.accessCode){const blob=new Blob([`Username: ${u.username}\nCampaign: ${u.specificText}\nAccess Code: ${u.accessCode}\n`],{type:'text/plain'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`adrevenue-${u.username}.txt`;document.body.appendChild(a);a.click();document.body.removeChild(a);}});

// Handle login
document.getElementById('loginBtn').addEventListener('click',()=>{
  const username=document.getElementById('loginUsername').value.trim();
  const masterPassword=document.getElementById('loginMasterPassword').value;
  const stored=JSON.parse(localStorage.getItem("adRevenueUser")||"{}");

  if(username===stored.username && generateAccessCode(stored.username,stored.specificText,masterPassword)===stored.accessCode){
    document.getElementById('loginSuccessMessage').style.display='block';
    setTimeout(()=>window.location.href='stats.html',1500);
  } else{
    document.getElementById('loginErrorMessage').style.display='block';
  }
});

// Prefill login if user exists
const savedUser=JSON.parse(localStorage.getItem("adRevenueUser")||"{}");
if(savedUser.username){tabs.forEach(t=>t.classList.remove('active'));document.querySelector('[data-tab="login"]').classList.add('active');tabContents.forEach(c=>c.classList.remove('active'));document.getElementById('login').classList.add('active');document.getElementById('loginUsername').value=savedUser.username;}
</script>
</body>
</html>