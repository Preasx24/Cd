<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Withdraw Earnings - AdRevenuePro</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --dark-bg: #0f0f23;
            --card-bg: #1a1b2e;
            --card-border: #2d2d4d;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--dark-bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            background-image: radial-gradient(circle at 15% 50%, rgba(29, 78, 216, 0.15) 0%, transparent 65%),
                              radial-gradient(circle at 85% 30%, rgba(139, 92, 246, 0.1) 0%, transparent 55%);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }

        .header p {
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--card-border);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-header h2 {
            font-size: 1.5rem;
            margin-left: 10px;
        }

        .icon {
            font-size: 1.8rem;
        }

        .balance-display {
            text-align: center;
            margin: 30px 0;
        }

        .balance-amount {
            font-size: 3.5rem;
            font-weight: 700;
            margin: 10px 0;
            color: var(--secondary);
        }

        .balance-label {
            color: var(--text-muted);
            font-size: 1.2rem;
        }

        .currency-converter {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .converter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .converter-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        select, input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px 15px;
            color: var(--text);
            font-size: 1rem;
            flex: 1;
        }

        .conversion-result {
            text-align: center;
            margin-top: 20px;
            font-size: 1.2rem;
        }

        .converted-amount {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .withdrawal-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .withdrawal-option {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .withdrawal-option:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .withdrawal-option.selected {
            border-color: var(--secondary);
            background: rgba(16, 185, 129, 0.1);
        }

        .option-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .option-name {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .option-desc {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .withdrawal-form {
            margin-top: 25px;
            display: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .withdrawal-info {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--warning);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .btn {
            padding: 14px 20px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            width: 100%;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:disabled {
            background: #4b5563;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        .withdrawal-history {
            margin-top: 30px;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-amount {
            font-weight: 600;
            color: var(--secondary);
        }

        .history-date {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .history-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .status-completed {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .status-failed {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error {
            background: var(--error);
        }

        .loading {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid var(--primary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        .amount-validation {
            margin-top: 10px;
            font-size: 0.9rem;
            min-height: 20px;
        }

        .validation-error {
            color: var(--error);
        }

        .validation-success {
            color: var(--success);
        }

        .card-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .card-input-group .form-group {
            margin-bottom: 0;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 600px) {
            .withdrawal-options {
                grid-template-columns: 1fr;
            }
            
            .balance-amount {
                font-size: 2.5rem;
            }
            
            .converter-controls {
                flex-direction: column;
            }
            
            .card-input-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Withdraw Earnings</h1>
            <p>Convert and withdraw your AdRevenuePro earnings</p>
        </div>
        
        <div class="card">
            <div class="card-header">
                <div class="icon">üí∞</div>
                <h2>Your Balance</h2>
            </div>
            
            <div class="balance-display">
                <div class="balance-label">Available for withdrawal</div>
                <div class="balance-amount" id="balanceAmount">$0.00</div>
            </div>
            
            <div class="withdrawal-info">
                <strong>Withdrawal Limit:</strong> Minimum withdrawal amount is $25.00. Processing may take 3-5 business days.
            </div>
            
            <div class="currency-converter">
                <div class="converter-header">
                    <h3>Currency Converter</h3>
                </div>
                
                <div class="converter-controls">
                    <input type="number" id="usdAmount" placeholder="Enter USD amount" step="0.01" min="0">
                    <select id="currencySelect">
                        <option value="EUR">Euro (EUR)</option>
                        <option value="GBP">British Pound (GBP)</option>
                        <option value="CAD">Canadian Dollar (CAD)</option>
                        <option value="AUD">Australian Dollar (AUD)</option>
                        <option value="JPY">Japanese Yen (JPY)</option>
                        <option value="INR">Indian Rupee (INR)</option>
                        <option value="ZAR">South African Rand (ZAR)</option>
                        <option value="NGN">Nigerian Naira (NGN)</option>
                    </select>
                </div>
                
                <div class="conversion-result">
                    <div>Equivalent in <span id="selectedCurrency">EUR</span>:</div>
                    <div class="converted-amount" id="convertedAmount">‚Ç¨0.00</div>
                    <div id="exchangeRate" style="font-size: 0.9rem; color: var(--text-muted); margin-top: 5px;"></div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <div class="icon">üè¶</div>
                <h2>Withdrawal Methods</h2>
            </div>
            
            <div class="withdrawal-options">
                <div class="withdrawal-option" data-method="paypal">
                    <div class="option-icon">üîµ</div>
                    <div class="option-name">PayPal</div>
                    <div class="option-desc">Instant transfer, 2.9% fee</div>
                </div>
                
                <div class="withdrawal-option" data-method="card">
                    <div class="option-icon">üí≥</div>
                    <div class="option-name">Debit/Credit Card</div>
                    <div class="option-desc">Direct to card, 3.5% fee</div>
                </div>
                
                <div class="withdrawal-option" data-method="crypto">
                    <div class="option-icon">‚Çø</div>
                    <div class="option-name">Cryptocurrency</div>
                    <div class="option-desc">Bitcoin, Ethereum, 1% fee</div>
                </div>
                
                <div class="withdrawal-option" data-method="bank">
                    <div class="option-icon">üè¶</div>
                    <div class="option-name">Bank Transfer</div>
                    <div class="option-desc">3-5 business days, $5 fee</div>
                </div>
            </div>
            
            <div id="paypalForm" class="withdrawal-form">
                <h3>PayPal Withdrawal</h3>
                <div class="form-group">
                    <label for="paypalEmail">PayPal Email Address</label>
                    <input type="email" id="paypalEmail" placeholder="your.email@example.com">
                </div>
                <div class="form-group">
                    <label for="paypalAmount">Amount to Withdraw (USD)</label>
                    <input type="number" id="paypalAmount" placeholder="25.00" step="0.01" min="0">
                    <div class="amount-validation" id="paypalValidation"></div>
                </div>
                <button class="btn btn-primary" id="paypalSubmit" disabled>Request Withdrawal</button>
                <button class="btn btn-secondary withdrawal-back">Back to Methods</button>
            </div>
            
            <div id="cardForm" class="withdrawal-form">
                <h3>Debit/Credit Card Withdrawal</h3>
                <div class="form-group">
                    <label for="cardNumber">Card Number</label>
                    <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                </div>
                <div class="card-input-group">
                    <div class="form-group">
                        <label for="cardExpiry">Expiry Date</label>
                        <input type="text" id="cardExpiry" placeholder="MM/YY" maxlength="5">
                    </div>
                    <div class="form-group">
                        <label for="cardCVC">CVC</label>
                        <input type="text" id="cardCVC" placeholder="123" maxlength="4">
                    </div>
                </div>
                <div class="form-group">
                    <label for="cardHolder">Cardholder Name</label>
                    <input type="text" id="cardHolder" placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label for="cardAmount">Amount to Withdraw (USD)</label>
                    <input type="number" id="cardAmount" placeholder="25.00" step="0.01" min="0">
                    <div class="amount-validation" id="cardValidation"></div>
                </div>
                <button class="btn btn-primary" id="cardSubmit" disabled>Request Withdrawal</button>
                <button class="btn btn-secondary withdrawal-back">Back to Methods</button>
            </div>
            
            <div id="cryptoForm" class="withdrawal-form">
                <h3>Cryptocurrency Withdrawal</h3>
                <div class="form-group">
                    <label for="cryptoType">Cryptocurrency</label>
                    <select id="cryptoType">
                        <option value="bitcoin">Bitcoin (BTC)</option>
                        <option value="ethereum">Ethereum (ETH)</option>
                        <option value="litecoin">Litecoin (LTC)</option>
                        <option value="usdt">Tether (USDT)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="cryptoAddress">Wallet Address</label>
                    <input type="text" id="cryptoAddress" placeholder="Enter your wallet address">
                </div>
                <div class="form-group">
                    <label for="cryptoAmount">Amount to Withdraw (USD)</label>
                    <input type="number" id="cryptoAmount" placeholder="25.00" step="0.01" min="0">
                    <div class="amount-validation" id="cryptoValidation"></div>
                </div>
                <button class="btn btn-primary" id="cryptoSubmit" disabled>Request Withdrawal</button>
                <button class="btn btn-secondary withdrawal-back">Back to Methods</button>
            </div>
            
            <div id="bankForm" class="withdrawal-form">
                <h3>Bank Transfer</h3>
                <div class="form-group">
                    <label for="bankAccount">Account Number</label>
                    <input type="text" id="bankAccount" placeholder="Enter your account number">
                </div>
                <div class="form-group">
                    <label for="bankRouting">Routing Number (US) / Sort Code (UK) / BSB (AU)</label>
                    <input type="text" id="bankRouting" placeholder="Enter routing number">
                </div>
                <div class="form-group">
                    <label for="bankAmount">Amount to Withdraw (USD)</label>
                    <input type="number" id="bankAmount" placeholder="25.00" step="0.01" min="0">
                    <div class="amount-validation" id="bankValidation"></div>
                </div>
                <button class="btn btn-primary" id="bankSubmit" disabled>Request Withdrawal</button>
                <button class="btn btn-secondary withdrawal-back">Back to Methods</button>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <div class="icon">üìã</div>
                <h2>Withdrawal History</h2>
            </div>
            
            <div class="withdrawal-history">
                <div class="history-list" id="withdrawalHistory">
                    <!-- History items will be added here dynamically -->
                </div>
            </div>
        </div>
        
        <a href="stats.html" class="btn btn-secondary" style="margin-top: 20px;">‚Üê Back to Dashboard</a>
    </div>
    
    <div class="toast" id="toast"></div>

    <script>
        // User data and configuration
        const mappingUrl = "https://gist.githubusercontent.com/Preasx24/4517ac43eff88b7e226fbbdc627a3c08/raw/gistfile1.txt";
        const user = JSON.parse(localStorage.getItem("adRevenueUser") || "{}");
        const WITHDRAWAL_MINIMUM = 25.00;
        
        // Check if user is logged in
        if (!user.accessCode) {
            document.body.innerHTML = `
                <div style="display: flex; justify-content: center; align-items: center; height: 100vh; flex-direction: column;">
                    <h1 style="color: #ef4444; margin-bottom: 20px;">‚ùå Access Denied</h1>
                    <p>You are not logged in. Please login to access the withdrawal page.</p>
                    <a href="index.html" style="margin-top: 20px; padding: 10px 20px; background: #6366f1; color: white; border-radius: 8px; text-decoration: none;">Go to Login</a>
                </div>
            `;
            throw new Error("No user");
        }
        
        // Exchange rates (in a real app, these would come from an API)
        const exchangeRates = {
            EUR: 0.85,
            GBP: 0.73,
            CAD: 1.25,
            AUD: 1.35,
            JPY: 110.50,
            INR: 74.50,
            ZAR: 14.75,
            NGN: 410.00
        };
        
        // Currency symbols
        const currencySymbols = {
            EUR: '‚Ç¨',
            GBP: '¬£',
            CAD: 'C$',
            AUD: 'A$',
            JPY: '¬•',
            INR: '‚Çπ',
            ZAR: 'R',
            NGN: '‚Ç¶'
        };
        
        // User's balance and withdrawal history (in a real app, this would come from the backend)
        let userBalance = 0;
        let withdrawalHistory = [];
        
        // DOM elements
        const balanceAmountEl = document.getElementById('balanceAmount');
        const usdAmountEl = document.getElementById('usdAmount');
        const currencySelectEl = document.getElementById('currencySelect');
        const convertedAmountEl = document.getElementById('convertedAmount');
        const selectedCurrencyEl = document.getElementById('selectedCurrency');
        const exchangeRateEl = document.getElementById('exchangeRate');
        const withdrawalOptions = document.querySelectorAll('.withdrawal-option');
        const withdrawalForms = document.querySelectorAll('.withdrawal-form');
        const withdrawalHistoryEl = document.getElementById('withdrawalHistory');
        const toastEl = document.getElementById('toast');
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadUserBalance();
            setupEventListeners();
            updateCurrencyConversion();
            loadWithdrawalHistory();
        });
        
        // Load user's balance from their gist
        async function loadUserBalance() {
            try {
                const map = await fetch(mappingUrl).then(r => r.json());
                const entry = map.find(e => e.accessCode === user.accessCode);
                
                if (!entry) {
                    showToast('User data not found', true);
                    return;
                }
                
                // Normalize gist API URL
                let gistApi;
                if (entry.gistUrl.includes("gist.github.com")) {
                    const gistId = entry.gistUrl.split("/").pop();
                    gistApi = "https://api.github.com/gists/" + gistId;
                } else {
                    gistApi = entry.gistUrl;
                }
                
                // Fetch stats
                const gist = await fetch(gistApi).then(r => r.json());
                if (gist.files && gist.files["stats.json"]) {
                    const stats = JSON.parse(gist.files["stats.json"].content);
                    userBalance = stats.revenue || 0;
                    
                    // Update balance display
                    balanceAmountEl.textContent = `$${userBalance.toFixed(2)}`;
                    usdAmountEl.value = userBalance.toFixed(2);
                    
                    // Update currency conversion
                    updateCurrencyConversion();
                }
            } catch (error) {
                console.error("Error loading user balance:", error);
                showToast('Error loading balance data', true);
            }
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Currency conversion
            usdAmountEl.addEventListener('input', updateCurrencyConversion);
            currencySelectEl.addEventListener('change', updateCurrencyConversion);
            
            // Withdrawal method selection
            withdrawalOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const method = this.getAttribute('data-method');
                    selectWithdrawalMethod(method);
                });
            });
            
            // Back buttons
            document.querySelectorAll('.withdrawal-back').forEach(button => {
                button.addEventListener('click', function() {
                    resetWithdrawalMethods();
                });
            });
            
            // Withdrawal form submissions
            document.getElementById('paypalSubmit').addEventListener('click', () => submitWithdrawal('paypal'));
            document.getElementById('cardSubmit').addEventListener('click', () => submitWithdrawal('card'));
            document.getElementById('cryptoSubmit').addEventListener('click', () => submitWithdrawal('crypto'));
            document.getElementById('bankSubmit').addEventListener('click', () => submitWithdrawal('bank'));
            
            // Amount validation for each form
            document.getElementById('paypalAmount').addEventListener('input', () => validateAmount('paypal'));
            document.getElementById('cardAmount').addEventListener('input', () => validateAmount('card'));
            document.getElementById('cryptoAmount').addEventListener('input', () => validateAmount('crypto'));
            document.getElementById('bankAmount').addEventListener('input', () => validateAmount('bank'));
            
            // Card number formatting
            document.getElementById('cardNumber').addEventListener('input', formatCardNumber);
            document.getElementById('cardExpiry').addEventListener('input', formatExpiryDate);
            document.getElementById('cardCVC').addEventListener('input', formatCVC);
        }
        
        // Update currency conversion
        function updateCurrencyConversion() {
            const usdAmount = parseFloat(usdAmountEl.value) || 0;
            const selectedCurrency = currencySelectEl.value;
            const rate = exchangeRates[selectedCurrency];
            const converted = usdAmount * rate;
            
            selectedCurrencyEl.textContent = selectedCurrency;
            convertedAmountEl.textContent = `${currencySymbols[selectedCurrency]}${converted.toFixed(2)}`;
            exchangeRateEl.textContent = `1 USD = ${rate.toFixed(4)} ${selectedCurrency}`;
        }
        
        // Select withdrawal method
        function selectWithdrawalMethod(method) {
            // Reset all options
            withdrawalOptions.forEach(option => {
                option.classList.remove('selected');
            });
            
            // Hide all forms
            withdrawalForms.forEach(form => {
                form.style.display = 'none';
            });
            
            // Select the clicked option
            document.querySelector(`.withdrawal-option[data-method="${method}"]`).classList.add('selected');
            
            // Show the corresponding form
            document.getElementById(`${method}Form`).style.display = 'block';
            
            // Set the amount field to the user's balance or minimum
            const amountField = document.getElementById(`${method}Amount`);
            if (amountField) {
                amountField.value = userBalance >= WITHDRAWAL_MINIMUM ? userBalance.toFixed(2) : WITHDRAWAL_MINIMUM.toFixed(2);
                validateAmount(method);
            }
        }
        
        // Reset withdrawal methods to initial state
        function resetWithdrawalMethods() {
            withdrawalOptions.forEach(option => {
                option.classList.remove('selected');
            });
            
            withdrawalForms.forEach(form => {
                form.style.display = 'none';
            });
        }
        
        // Validate withdrawal amount
        function validateAmount(method) {
            const amountField = document.getElementById(`${method}Amount`);
            const validationEl = document.getElementById(`${method}Validation`);
            const submitBtn = document.getElementById(`${method}Submit`);
            
            if (!amountField || !validationEl || !submitBtn) return;
            
            const amount = parseFloat(amountField.value);
            
            // Reset validation message and button state
            validationEl.textContent = '';
            validationEl.className = 'amount-validation';
            submitBtn.disabled = true;
            
            if (!amount || amount <= 0) {
                validationEl.textContent = 'Please enter a valid amount';
                validationEl.className = 'amount-validation validation-error';
                return;
            }
            
            if (amount > userBalance) {
                validationEl.textContent = `Insufficient balance. Your available balance is $${userBalance.toFixed(2)}`;
                validationEl.className = 'amount-validation validation-error';
                return;
            }
            
            if (amount < WITHDRAWAL_MINIMUM) {
                validationEl.textContent = `Minimum withdrawal amount is $${WITHDRAWAL_MINIMUM.toFixed(2)}`;
                validationEl.className = 'amount-validation validation-error';
                return;
            }
            
            // All validations passed
            validationEl.textContent = `‚úÖ You can withdraw $${amount.toFixed(2)}`;
            validationEl.className = 'amount-validation validation-success';
            submitBtn.disabled = false;
        }
        
        // Submit withdrawal request
        function submitWithdrawal(method) {
            const amountField = document.getElementById(`${method}Amount`);
            const amount = parseFloat(amountField.value);
            
            // Final validation
            if (!amount || amount < WITHDRAWAL_MINIMUM || amount > userBalance) {
                showToast('Invalid withdrawal amount', true);
                return;
            }
            
            // Method-specific validation
            let valid = true;
            let message = '';
            
            switch(method) {
                case 'paypal':
                    const paypalEmail = document.getElementById('paypalEmail').value;
                    if (!paypalEmail || !isValidEmail(paypalEmail)) {
                        valid = false;
                        message = 'Please enter a valid PayPal email';
                    }
                    break;
                    
                case 'card':
                    const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
                    const expiry = document.getElementById('cardExpiry').value;
                    const cvc = document.getElementById('cardCVC').value;
                    const holder = document.getElementById('cardHolder').value;
                    
                    if (!isValidCardNumber(cardNumber)) {
                        valid = false;
                        message = 'Please enter a valid card number';
                    } else if (!isValidExpiryDate(expiry)) {
                        valid = false;
                        message = 'Please enter a valid expiry date (MM/YY)';
                    } else if (!isValidCVC(cvc)) {
                        valid = false;
                        message = 'Please enter a valid CVC';
                    } else if (!holder.trim()) {
                        valid = false;
                        message = 'Please enter cardholder name';
                    }
                    break;
                    
                case 'crypto':
                    const address = document.getElementById('cryptoAddress').value;
                    if (!address) {
                        valid = false;
                        message = 'Please enter a valid wallet address';
                    }
                    break;
                    
                case 'bank':
                    const account = document.getElementById('bankAccount').value;
                    const routing = document.getElementById('bankRouting').value;
                    if (!account || !routing) {
                        valid = false;
                        message = 'Please enter both account and routing numbers';
                    }
                    break;
            }
            
            if (!valid) {
                showToast(message, true);
                return;
            }
            
            // Simulate withdrawal processing
            processWithdrawal(method, amount);
        }
        
        // Process withdrawal (simulated)
        function processWithdrawal(method, amount) {
            // In a real app, this would make an API call to your backend
            
            // Create withdrawal record
            const withdrawal = {
                id: Date.now(),
                method: method,
                amount: amount,
                date: new Date().toISOString().split('T')[0],
                status: 'pending',
                fee: calculateFee(method, amount)
            };
            
            // Add to history
            withdrawalHistory.unshift(withdrawal);
            saveWithdrawalHistory();
            
            // Update balance (in a real app, this would happen on the backend)
            userBalance -= amount;
            balanceAmountEl.textContent = `$${userBalance.toFixed(2)}`;
            usdAmountEl.value = userBalance.toFixed(2);
            updateCurrencyConversion();
            
            // Update UI
            loadWithdrawalHistory();
            resetWithdrawalMethods();
            
            // Show success message
            showToast(`Withdrawal request for $${amount.toFixed(2)} submitted successfully!`);
        }
        
        // Calculate withdrawal fee
        function calculateFee(method, amount) {
            switch(method) {
                case 'paypal': return amount * 0.029;
                case 'card': return amount * 0.035;
                case 'bank': return 5.00;
                case 'crypto': return amount * 0.01;
                default: return 0;
            }
        }
        
        // Load withdrawal history
        function loadWithdrawalHistory() {
            // Load from localStorage (in a real app, this would come from the backend)
            const savedHistory = localStorage.getItem(`withdrawalHistory_${user.accessCode}`);
            if (savedHistory) {
                withdrawalHistory = JSON.parse(savedHistory);
            }
            
            // Update UI
            if (withdrawalHistory.length === 0) {
                withdrawalHistoryEl.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">No withdrawal history yet</div>';
                return;
            }
            
            let html = '';
            withdrawalHistory.forEach(withdrawal => {
                html += `
                    <div class="history-item">
                        <div>
                            <div class="history-amount">$${withdrawal.amount.toFixed(2)}</div>
                            <div class="history-date">${withdrawal.date} ‚Ä¢ ${withdrawal.method.charAt(0).toUpperCase() + withdrawal.method.slice(1)}</div>
                        </div>
                        <div class="history-status status-${withdrawal.status}">${withdrawal.status.charAt(0).toUpperCase() + withdrawal.status.slice(1)}</div>
                    </div>
                `;
            });
            
            withdrawalHistoryEl.innerHTML = html;
        }
        
        // Save withdrawal history to localStorage
        function saveWithdrawalHistory() {
            localStorage.setItem(`withdrawalHistory_${user.accessCode}`, JSON.stringify(withdrawalHistory));
        }
        
        // Show toast notification
        function showToast(message, isError = false) {
            toastEl.textContent = message;
            toastEl.className = 'toast' + (isError ? ' error' : '');
            toastEl.classList.add('show');
            
            setTimeout(() => {
                toastEl.classList.remove('show');
            }, 3000);
        }
        
        // Validate email format
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // Validate card number using Luhn algorithm
        function isValidCardNumber(cardNumber) {
            // Remove spaces and check if it's a number
            const cleaned = cardNumber.replace(/\s/g, '');
            if (!/^\d+$/.test(cleaned)) return false;
            
            // Luhn algorithm
            let sum = 0;
            let isEven = false;
            
            for (let i = cleaned.length - 1; i >= 0; i--) {
                let digit = parseInt(cleaned.charAt(i), 10);
                
                if (isEven) {
                    digit *= 2;
                    if (digit > 9) {
                        digit -= 9;
                    }
                }
                
                sum += digit;
                isEven = !isEven;
            }
            
            return (sum % 10) === 0;
        }
        
        // Validate expiry date (MM/YY format)
        function isValidExpiryDate(expiry) {
            if (!/^\d{2}\/\d{2}$/.test(expiry)) return false;
            
            const [month, year] = expiry.split('/').map(Number);
            if (month < 1 || month > 12) return false;
            
            const currentYear = new Date().getFullYear() % 100;
            const currentMonth = new Date().getMonth() + 1;
            
            if (year < currentYear) return false;
            if (year === currentYear && month < currentMonth) return false;
            
            return true;
        }
        
        // Validate CVC (3 or 4 digits)
        function isValidCVC(cvc) {
            return /^\d{3,4}$/.test(cvc);
        }
        
        // Format card number with spaces
        function formatCardNumber(e) {
            let input = e.target.value.replace(/\s/g, '');
            if (input.length > 16) input = input.substring(0, 16);
            
            let formatted = '';
            for (let i = 0; i < input.length; i++) {
                if (i > 0 && i % 4 === 0) formatted += ' ';
                formatted += input[i];
            }
            
            e.target.value = formatted;
        }
        
        // Format expiry date as MM/YY
        function formatExpiryDate(e) {
            let input = e.target.value.replace(/\D/g, '');
            if (input.length > 4) input = input.substring(0, 4);
            
            if (input.length >= 2) {
                e.target.value = input.substring(0, 2) + '/' + input.substring(2);
            } else {
                e.target.value = input;
            }
        }
        
        // Format CVC (numbers only)
        function formatCVC(e) {
            e.target.value = e.target.value.replace(/\D/g, '');
        }
    </script>
</body>
</html>